<script>
/* ====== Artifact containers (same as before) ====== */
const ITEMS = [
  { id:"sample-capture", title:"15–30s Sample Capture", tag:"Video",
    desc:"Quick screen recording (OBS/Kdenlive) demonstrating polish and voice levels.",
    links:[ {label:"Play MP4", href:"/artifacts/2025-10-sample-capture.mp4"},
            {label:"Play WEBM", href:"/artifacts/2025-10-sample-capture.webm"} ],
    checklist:["Audio balanced (voice ≥ -16 LUFS)","Cursor/zoom clear at 100–125%","No PII visible"], notes:"" },
  { id:"portfolio-shell", title:"Portfolio Shell (3 Empty Slots)", tag:"Site",
    desc:"Live portfolio with three reserved placeholders for work samples.",
    links:[ {label:"Open Home", href:"/"},
            {label:"Slot 1 Page", href:"/work/slot-1.html"},
            {label:"Slot 2 Page", href:"/work/slot-2.html"},
            {label:"Slot 3 Page", href:"/work/slot-3.html"} ],
    checklist:["Home has two tiles (Artifacts, Résumé)","Three sample slots visible","Mobile layout verified"],
    notes:"If slot pages don’t exist yet, create /work/*.html later." },
  { id:"h5p-microlearning", title:"H5P Microlearning (10–15 min)", tag:"H5P",
    desc:"Interactive video + checks; exported for web; accessibility notes included.",
    links:[ {label:"Open H5P (HTML export)", href:"/artifacts/h5p-microlearning.html"},
            {label:"Download .h5p source", href:"/artifacts/h5p-microlearning.h5p"},
            {label:"WCAG Notes (PDF)", href:"/artifacts/h5p-wcag-notes.pdf"} ],
    checklist:["Captions on video segments","Color contrast ≥ 4.5:1","Keyboard-only completes all interactions"],
    notes:"Created in Lumi or Moodle H5P; export as single HTML for Pages." },
  { id:"adapt-scorm", title:"Adapt Course (SCORM)", tag:"SCORM",
    desc:"Adapt Authoring course with quiz; provide SCORM 1.2 & 2004 packages plus a web build.",
    links:[ {label:"Download SCORM 1.2 ZIP", href:"/artifacts/adapt-course-scorm12.zip"},
            {label:"Download SCORM 2004 ZIP", href:"/artifacts/adapt-course-scorm2004.zip"},
            {label:"Live Web Build", href:"/artifacts/adapt-web/index.html"} ],
    checklist:["SCORM 1.2 passes LMS test","SCORM 2004 passes LMS test","Web build loads on GitHub Pages"],
    notes:"Keep SCORM Zips < 100MB for repo; use Git LFS if needed." },
  { id:"lms-tracking-gif", title:"LMS Tracking Proof (GIF)", tag:"GIF",
    desc:"30s capture showing completion/score reported by LMS from the Adapt package.",
    links:[ {label:"View Tracking GIF", href:"/artifacts/adapt-tracking.gif"} ],
    checklist:["Shows course launch → attempt → completion","Score visible in LMS gradebook","GIF ≤ 15 MB"],
    notes:"Use OBS + convert to GIF (ffmpeg/convert) or Kdenlive render." },
  { id:"assessment-pack", title:"Assessment Pack", tag:"PDF + Video",
    desc:"Standards-aligned item bank + rubric + remediation guide + 2-min walkthrough.",
    links:[ {label:"Download Assessment Pack (PDF)", href:"/artifacts/assessment-pack.pdf"},
            {label:"Watch 2-min Screencast", href:"/artifacts/assessment-walkthrough.mp4"} ],
    checklist:["Standards mapping table included","Rubric & remediation steps clear","PDF tagged for accessibility"],
    notes:"Tag PDF for headings, lists, tables; include alt text for figures." },
  { id:"narratives", title:"Portfolio Narratives", tag:"HTML",
    desc:"Problem → Design → Outcomes write-ups for each artifact.",
    links:[ {label:"Narrative: H5P Microlearning", href:"/mandy/narratives/h5p-microlearning.html"},
            {label:"Narrative: Adapt Course", href:"/mandy/narratives/adapt-course.html"},
            {label:"Narrative: Assessment Pack", href:"/mandy/narratives/assessment-pack.html"} ],
    checklist:["Each narrative ≤ 500 words","Metrics & evidence included","Role split: what Mandy did vs. tools"],
    notes:"Create HTML files under /mandy/narratives/ as you draft." },
  { id:"resume-sow", title:"Résumé + Micro SOW Template", tag:"Docs",
    desc:"Final 1-page résumé plus a short Statement of Work template for proposals.",
    links:[ {label:"Résumé (PDF)", href:"/A.%20Miller%20Resume%202025-2.pdf"},
            {label:"SOW Template (Markdown)", href:"/SOW.md"} ],
    checklist:["Résumé is ATS-friendly PDF","SOW has scope, deliverables, timeline, rate","Contact details consistent"],
    notes:"If SOW.md doesn’t exist yet, add one at repo root." }
];

/* ====== Persistence & UI ====== */
const KEY = "mandy_portfolio_containers_v1";
let SAVED = JSON.parse(localStorage.getItem(KEY) || "{}");

const CARDS = document.getElementById('cards');
document.getElementById('year').textContent = new Date().getFullYear();

function cardHTML(item, saved) {
  const status = (saved?.status) || "Not Started";
  const notes  = (saved?.notes)  || item.notes || "";
  const checks = (saved?.checks) || Array(item.checklist.length).fill(false);
  const done   = checks.filter(Boolean).length;
  const total  = checks.length;
  const progress = Math.round(100 * done / total);

  const linksHTML = item.links.map(l => `<a class="btn" href="${l.href}" target="_blank" rel="noopener">${l.label}</a>`).join("");
  const checklistHTML = item.checklist.map((c, i) => `
    <label><input type="checkbox" data-id="${item.id}" data-idx="${i}" ${checks[i] ? "checked":""} /> <span>${c}</span></label>
  `).join("");

  return `
    <article class="card" id="${item.id}">
      <div class="title">
        <div>
          <h3 style="margin:.2rem 0">${item.title}</h3>
          <div class="muted">${item.desc} <span class="pill">${item.tag}</span></div>
        </div>
        <div>
          <select data-id="${item.id}" class="status">
            ${["Not Started","In Progress","Blocked","Done"].map(s=>`<option ${s===status?"selected":""}>${s}</option>`).join("")}
          </select>
        </div>
      </div>

      <div class="links">${linksHTML}</div>

      <div class="checklist">${checklistHTML}</div>

      <div class="row" style="gap:10px;align-items:center">
        <div class="bar" style="width:220px"><span style="width:${progress}%" data-prog="${item.id}"></span></div>
        <span class="muted" data-count="${item.id}">${done}/${total} checklist items done</span>
      </div>

      <div>
        <label class="muted" for="n-${item.id}">Notes</label>
        <textarea id="n-${item.id}" data-id="${item.id}" rows="3" placeholder="Add notes, links, or to-dos…">${notes}</textarea>
      </div>
    </article>
  `;
}

function save(id, data){
  SAVED[id] = {...(SAVED[id]||{}), ...data};
  localStorage.setItem(KEY, JSON.stringify(SAVED));
}

function render(){
  CARDS.innerHTML = ITEMS.map(it => cardHTML(it, SAVED[it.id])).join("");

  // Status changes
  CARDS.querySelectorAll('select.status').forEach(sel=>{
    sel.onchange = ()=>{
      const id = sel.dataset.id;
      save(id, {status: sel.value});
      updateOverall();
    };
  });

  // Checklist changes (fix)
  CARDS.querySelectorAll('input[type=checkbox]').forEach(cb=>{
    cb.onchange = ()=>{
      const id = cb.dataset.id;
      const card = document.getElementById(id);
      const boxes = card.querySelectorAll('input[type=checkbox]');
      const cur = Array.from(boxes).map(b => b.checked);

      save(id, {checks: cur});

      const done = cur.filter(Boolean).length;
      const total = cur.length;
      const pct = Math.round(100 * done / total);

      const progEl = card.querySelector(`span[data-prog="${id}"]`);
      const txtEl  = card.querySelector(`[data-count="${id}"]`);
      if (progEl) progEl.style.width = pct + "%";
      if (txtEl)  txtEl.textContent  = `${done}/${total} checklist items done`;

      updateOverall();
    };
  });

  // Notes
  CARDS.querySelectorAll('textarea').forEach(ta=>{
    ta.oninput = ()=> save(ta.dataset.id, {notes: ta.value});
  });

  updateOverall();
}

function updateOverall(){
  const totals = ITEMS.map(it => (SAVED[it.id]?.checks || Array(it.checklist.length).fill(false)));
  const done = totals.reduce((a,arr)=>a + arr.filter(Boolean).length, 0);
  const total = totals.reduce((a,arr)=>a + arr.length, 0);
  const pct = total ? Math.round(100*done/total) : 0;
  const bar = document.getElementById('overall');
  const text = document.getElementById('statTxt');
  if (bar)  bar.style.width = pct + "%";
  if (text) text.textContent = `${done}/${total} checklist items complete`;
}

render();
</script>
